<!-- HTML header for doxygen 1.9.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dynamic Script Engine Plugin for Touch Portal: Color Mixer Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init();
    DoxygenAwesomeParagraphLink.init();
    DoxygenAwesomeInteractiveToc.init();
    // hide the Documentation header and sidebar link since it's redundant when on the docs site already.
    $(window).on('load', () => {
      function removeElements() {
        if (!$("a[class='index.html:autotoc_md11']").length)
          setTimeout(removeElements, 10);
        var el = document.getElementById("autotoc_md11"),
          els = document.getElementsByClassName("index.html:autotoc_md11");
        if (el)
          el.parentNode.style.display = 'none';
        if (els.length)
          els[0].parentElement.parentElement.parentElement.style.display= 'none';
      };
      removeElements();
    });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/mpaperno/DSEP4TP" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z" fill="url(#gradient)"></path>
    <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
    <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    <linearGradient id="gradient" x1="0.5" x2="0.5" y1="0" y2="1">
        <stop class="first-stop" offset="0%"></stop>
        <stop class="last-stop" offset="100%"></stop>
    </linearGradient>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Logo.png" title="Dynamic Script Engine Plugin for Touch Portal - A complete, standalone, multi-threaded JavaScript environment available as a plugin for use with Touch Portal macro launcher software."/></td>
  <td id="projectalign">
   <div id="projectname"><!-- Dynamic Script Engine Plugin for Touch Portal --><span id="projectnumber">&#160;v1.2.0.1-beta1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('example_color_picker.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="class_color.html" title="Provides functions for working with color.">Color</a> Mixer Example </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_D__Devel_TouchPortal_DynamicScriptEngine_DSEP4TP_resources_examples_ColorPicker_README"></a>A script and page example of an interface for choosing a color.</p>
<div class="hide-on-site"></div><div class="hide-on-site"><b>See the <a href="https://dse.tpp.max.paperno.us/example_color_mixer.html" target="_blank">published documentation</a> for a properly formatted version of this README.</b> </div><p >Besides being an actual useful tool, this example demonstrates how to use several available classes and Touch Portal integration features. To create similar functionality would typically require a dedicated plugin in itself. But with <em><a class="el" href="class_d_s_e.html" title="The DSE object contains constants and functions related to the plugin environment....">DSE</a></em> it can be created with some relatively simple scripting, and customized "on the fly" without editing configuration files or restarting Touch Portal for each change (also not needing yet another network client and process running in the background).</p>
<h2><a class="anchor" id="autotoc_md105"></a>
Plugin components and features used:</h2>
<ul>
<li><a class="el" href="class_color.html" title="Provides functions for working with color.">Color</a> library for the primary functionality (choosing and previewing colors).</li>
<li>Using Touch Portal Sliders (connectors), both for input (to change color) and as a visual indicator of current channel values (move related sliders as color changes).</li>
<li>Saving and restoring the last "state" of the color mixer page when Touch Portal/the plugin shut down and restart, including the last selected color, series, and the other options presented on the page.</li>
<li><a class="el" href="class_clipboard.html" title="The Clipboard class offers a simple mechanism to copy and paste data between applications.">Clipboard</a> features provided by the <a class="el" href="class_clipboard.html" title="The Clipboard class offers a simple mechanism to copy and paste data between applications.">Clipboard</a> module for copying colors to/from other applications and monitoring the clipboard for changes after a local color picker utility has been launched.</li>
<li>Using separate Script instances for the color adjustment buttons which act independently of each other, with adjustable repeat rate and delay settings.</li>
</ul>
<p >The script itself is mostly just an "interface" to the various color manipulation features available with a <a class="el" href="class_color.html" title="Provides functions for working with color.">Color</a> object. It stores an instance of a <a class="el" href="class_color.html" title="Provides functions for working with color.">Color</a> value, which is the "current color," and all operations are performed on this color, after which it is usually sent back to Touch Portal as a new color value to be displayed somewhere (like the central "swatch" in the example page).</p>
<p >The example page uses 7 Sliders as inputs to control various aspects of the color (color channel values and opacity). Each color channel is controlled by a Slider and also the corresponding up/down buttons. The color can be changed from the same screen using either RGB or HSV channels. When a channel is modified in one color model (eg. Red), the changes are reflected in the other model's sliders, eg. moving the hue/saturation/value to corresponding positions.</p>
<p >The up/down buttons for each input value are there because Touch Portal Sliders only have a resolution of 0 through 100 in whole steps (1, 2, 3, etc), whereas most of the actual color values can be in a range of 0 through 255 (or 0-360 for Hue and fractional percent for saturation and value). So, the buttons provide a way to "fine tune" the value to account for the missing resolution of the sliders.</p>
<p >An additional Slider is provided to rotate the swatch overlay text color, or to set it to automatic (white or black text depending on the overall darkness of the main color).</p>
<p >Additionally there are buttons to invoke clipboard functions to copy the current color to clipboard in various formats, and another button to set the current color <em>from</em> a value on the clipboard (it has to be in one of the recognized formats... see <code>setColor()</code> notes in the code below).</p>
<p >Last but not least there are options to show colors complementary to the current one, or select one of a "series" of colors reflecting various aspects of the current main color, such as harmonious or analogous colors. These additional colors can be generated on demand by pressing the corresponding buttons, and/or set to automatically update when the main color changes by toggling the "Auto Update" feature.</p>
<p >Pressing the color complement/series color swatches can either copy that color to the clipboard, or select it as the current main color, depending on the "ON PRESS" switch position.</p>
<p ><em>All</em> of the States necessary for all this functionality, are created dynamically in the script as needed. For example the color series States are only created if that feature of the page is used. Each individual color channel value (R/G/B/A/H/S/V) are sent as individual States, which in this page are displayed under the corresponding sliders.</p>
<dl class="section note"><dt>Note</dt><dd>Assets for this example, including the code and page shown below, can be found in the project's repository at<br  />
 <a href="https://github.com/mpaperno/DSEP4TP/tree/next/resources/examples/ColorPicker/">https://github.com/mpaperno/DSEP4TP/tree/next/resources/examples/ColorPicker/</a></dd></dl>
<h2><a class="anchor" id="autotoc_md106"></a>
Example page using this script</h2>
<p ><a href="example_color_mixer_screenshot.jpg" target="image" title="Click for full version in new window."><img src="example_color_mixer_screenshot.jpg" alt="" class="inline"/> </a></p>
<h2><a class="anchor" id="autotoc_md107"></a>
Initial page setup</h2>
<ol type="1">
<li>Download the <a href="https://github.com/mpaperno/DSEP4TP/raw/next/resources/examples/ColorPicker/DSE_Color_Mixer_v1.tpz" target="_blank">DSE_Color_Mixer_v1 page</a>.</li>
<li>Import the page into Touch Portal<ul>
<li>The script files used in the example are already included in the page's archive and will be copied into your Touch Portal data directory, into the "misc" subfolder.</li>
</ul>
</li>
<li>Create a new button somewhere (eg. on your (main) page) that opens this page on your Touch Portal Android/iOS device.</li>
<li>Navigate to the new page on your device, and then press the INITIALIZE button.<ul>
<li>This only needs to be done once when you first import the page. After that everything should be re-created automatically next time you start Touch Portal (or restart this plugin).</li>
</ul>
</li>
<li>The "INITIALIZE" button should turn into a white color swatch and the page is ready for use.</li>
<li>If you make any changes to the included script file, you need to use the "Reset Module" button to clear out the old script version before your changes will be detected.</li>
</ol>
<h3><a class="anchor" id="autotoc_md108"></a>
The "color picker" button</h3>
<p >You may notice that button on the bottom row with the technicolor dropper icon. This is meant to launch a "color picker" utility on your computer, which would then copy the color from any part of the screen you click on to the clipboard. This utility is going to be operating system-specific, and you may prefer one over another.</p>
<p >The current button on the page is set up to launch the Windows 10/11 "Power Toys" <a class="el" href="class_color.html" title="Provides functions for working with color.">Color</a> Picker utility by pressing its default shortcut key combination of <code>WIN+SHIFT+C</code>. (<em>Power Toys</em> is a collection of utilities from a Microsoft-supported but independent open-source project.) You may of course prefer some other utility, and if you're on MacOS or Linux then clearly you'll need some other option.</p>
<p >After the button is pressed, the script will wait up to 30 seconds for the clipboard contents to change. If the clipboard is updated, the new clipboard value is checked to see if it contains a valid color. And if it does, then the main selected color is changed to that value.</p>
<h2><a class="anchor" id="autotoc_md109"></a>
Color Mixer script</h2>
<div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/* Dynamic Script Engine - Color Panel Script</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"></span> </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> This script is meant to accompany the Color Panel example Touch Portal page which should be distributed alongside.</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"></span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> This is in a lot of ways like a mini-plugin in itself, as it provides a lot of functionality one would otherwise need</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> an actual Touch Portal plugin for.</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"></span> </div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">The code is organized starting with basic functions first, such as for setting and adjusting colors, and progressing to &quot;extra&quot;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">functionality like providing the color series options and so on.  At the end are the &quot;internal&quot; bits, including data storage,</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">initialization, and utility functions.</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"></span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">Any function marked as `export` can be used in a Touch Portal DSE action. The others are for internal use.</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"></span> </div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment">*/</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">// Import clipboard functions from Clipboard example module.  The import path assumes both examples are in the same folder.</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="keyword">import</span> { valueToClipboard, clipboardToValue } from <span class="stringliteral">&quot;clipboard.mjs&quot;</span>;</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment">// Export the clipboard copy function as simply &#39;copy()&#39; so it is available directly from TP actions (as `M.copy()`) w/out another import.</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>export { valueToClipboard as copy };</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">// This script creates Touch Portal States dynamically as needed.</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment">// This variable sets the title under which all the created States are grouped.</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment">// The group will appear as a child of the Dynamic Script Engine main plugin grouping in TP menus.</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>export var STATES_GROUP_NAME = <span class="stringliteral">&quot;Color Panel&quot;</span>;</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="comment">// And this is the &quot;pretty&quot; State name for Touch Portal selectors.</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>export var STATE_CURRENT_COLOR_NAME = STATES_GROUP_NAME + <span class="stringliteral">&quot; - Current Color&quot;</span>;</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="comment">// Template for formatted color value. .NET String.Format() style.</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="comment">// Template values are (&quot;real&quot; means 0-1 range, &quot;int&quot; means 0-255 (or 0-359 for Hue)):</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="comment">//     0 = red (real); 1 = blue (real); 2 = green (real); 3 = alpha (real); 4 = hue (real); 5 = saturation (real); 6 = value (real); 7 = lightness (real);</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="comment">//     8 = red (int); 9 = blue (int); 10 = green (int); 11 = alpha (int); 12 = hue (° int); 13 = saturation (int); 14 = value (int); 15 = lightness (int)</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="comment">//export var FORMATTED_COLOR_TEMPLATE = &quot;{0:F2} {1:F2} {2:F2} {3:F2}\n{4:F2} {5:F2} {6:F2} {7:F2}\n{8:X2} {9:X2} {10:X2} {11:X2}\n{12:000} {13:000} {14:000} {15:000}&quot;; // uncomment this line to see what all the fields look like</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>export var FORMATTED_COLOR_TEMPLATE = <span class="stringliteral">&quot;R: {8:000}\t\tH {12:000}°\nG: {9:000}\t\tS {13:000}\nB: {10:000}\t\tV {14:000}\nA: {11:000}\t\tL {15:000}\n\n\t{8:X2} {9:X2} {10:X2} {11:X2}&quot;</span>;</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="comment">// Returns the current Color object, on which various methods can be invoked directly.</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="comment">// See documentation at: https://dse.tpp.max.paperno.us/class_color.html</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>export <span class="keyword">function</span> color()</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>{</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>  <span class="keywordflow">return</span> _data.color;</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>}</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span> </div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="comment">// Returns current color in &quot;Touch Portal&quot; format of #AARRGGBB format,</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="comment">// suitable for use in an &quot;Change visuals by plug-in state&quot; action.</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>export <span class="keyword">function</span> <a class="code hl_function" href="class_color.html#af7a57ec62f370d92e749c92e43e62f68">tpcolor</a>()</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>{</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>  <span class="keywordflow">return</span> color().tpcolor();</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>}</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="comment">// Sets the current color to `color` which can be:</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="comment">// - An hex string in &quot;#RRGGBB[AA]&quot; format, with or w/out the leading &quot;#&quot;;</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="comment">// - A color name from CSS specification, eg &quot;red&quot;, &quot;darkblue&quot;, etc.;</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="comment">// - Any other valid CSS-style color specifier string, eg. &quot;rgba(255, 0, 0, .5)&quot; or &quot;hsl(0, 100%, 50%)&quot; or &quot;hsva(0, 100%, 50%, .5)&quot;, etc.;</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="comment">// - An object representing rgb[a]/hsl[a]/hsv[a] values, eg. `{ r: 255, g: 0, b: 0 }` or  `{ h: 0, s: 1, l: .5, a: .75 }` or `{ h: 0, s: 100, v: 100 }`;</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="comment">// - Another Color object instance.</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>export <span class="keyword">function</span> setColor(color)</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>{</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>  _data.color = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>(color);</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>  <span class="keywordflow">return</span> update(3);</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>}</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="comment">// Sets the current color from an &quot;#AARRGGBB&quot; format string (this format is used by Touch Portal</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="comment">// for button background colors in &quot;Change visuals by plug-in state&quot; actions).</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>export <span class="keyword">function</span> setColorArgb(color)</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>{</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>  <span class="keyword">const</span> newColor = colorFromArgb(color);</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>  <span class="keywordflow">if</span> (newColor.isValid())</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <span class="keywordflow">return</span> setColor(newColor);</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>  console.error(`<span class="stringliteral">&#39;${color}&#39;</span> is not a valid color.`);</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="class_color.html#af7a57ec62f370d92e749c92e43e62f68">tpcolor</a>();</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>}</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="comment">// ------------------------------------------</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="comment">// Color channel/component setting functions.</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span><span class="comment">// The following functions set a corresponding channel of the current color to a percentage value (0 - 100).</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="comment">// If `updateConnector` is true then the corresponding slider will also be repositioned (see adjustment functions below;</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span><span class="comment">// when adjusting using a slider, this should be `false`).</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span> </div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>export <span class="keyword">function</span> setRed(percent, updateConnector = <span class="keyword">false</span>)</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>{</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>  color()._r = percentToShort(percent);</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>  <span class="keywordflow">if</span> (updateConnector)</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    updateRedConnector(color()._r);</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>  <span class="keywordflow">return</span> update(2);</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>}</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span> </div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>export <span class="keyword">function</span> setGreen(percent, updateConnector = <span class="keyword">false</span>)</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>{</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>  color()._g = percentToShort(percent);</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>  <span class="keywordflow">if</span> (updateConnector)</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    updateGreenConnector(color()._g);</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>  <span class="keywordflow">return</span> update(2);</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>}</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span> </div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>export <span class="keyword">function</span> setBlue(percent, updateConnector = <span class="keyword">false</span>)</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>{</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>  color()._b = percentToShort(percent);</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>  <span class="keywordflow">if</span> (updateConnector)</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    updateBlueConnector(color()._b);</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>  <span class="keywordflow">return</span> update(2);</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>}</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>export <span class="keyword">function</span> setAlpha(alpha, updateConnector = <span class="keyword">false</span>)</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>{</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>  color().setAlpha(alpha * 0.01);</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>  <span class="keywordflow">if</span> (updateConnector)</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    updateAlphaConnector(color().alpha());</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>  <span class="keywordflow">return</span> update(0);  <span class="comment">// alpha is only controlled by one slider, no other connector updates needed.</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>}</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>export <span class="keyword">function</span> setHue(percent, updateConnector = <span class="keyword">false</span>)</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>{</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>  var hsv = color().toHsv();</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>  hsv.h = percentToDegrees(percent);</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>  _data.color = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>(hsv);</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>  <span class="keywordflow">if</span> (updateConnector)</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    updateHueConnector(hsv.h);</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>  <span class="keywordflow">return</span> update(1);</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>}</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span> </div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>export <span class="keyword">function</span> setSaturation(percent, updateConnector = <span class="keyword">false</span>)</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>{</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>  <span class="keywordflow">if</span> (percent === 1)</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    percent += .01;</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>  var hsv = color().toHsv();</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>  hsv.s = percent;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>  _data.color = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>(hsv);</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>  <span class="keywordflow">if</span> (updateConnector)</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    updateSatConnector(hsv.s);</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>  <span class="keywordflow">return</span> update(1);</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>}</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span> </div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>export <span class="keyword">function</span> setValue(percent, updateConnector = <span class="keyword">false</span>)</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>{</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>  <span class="keywordflow">if</span> (percent === 1)</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    percent += .01;</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>  var hsv = color().toHsv();</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>  hsv.v = percent;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>  _data.color = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>(hsv);</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>  <span class="keywordflow">if</span> (updateConnector)</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    updateValueConnector(hsv.v);</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>  <span class="keywordflow">return</span> update(1);</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>}</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span> </div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span><span class="comment">// Note that this changes the color space of the current color to HSL.</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>export <span class="keyword">function</span> setLightness(percent)</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>{</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>  <span class="keywordflow">if</span> (percent === 1)</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    percent += .01;</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>  var hsl = color().toHsl();</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>  hsl.l = percent;</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>  _data.color = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>(hsl);</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>  <span class="keywordflow">return</span> update(3);</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>}</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span> </div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span><span class="comment">// ------------------------------------------</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span><span class="comment">// Adjustment (step increment/decrement) functions.</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span> </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span><span class="comment">// The following functions are used to adjust the individual color channels by a set +/- amount from what they currently are.</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span><span class="comment">// They will wrap the result values into a range between the minimum and maximum values of the corresponding channel (eg. for red: 255 + 1 = 0).</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span><span class="comment">// For the RGBA channels the steps are integer values in the range of (-255 - +255).</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span> </div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>export <span class="keyword">function</span> adjustRed(amount)</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>{</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>  <span class="keywordflow">return</span> setRed(shortToPercent(wrapShort(color()._r, amount)), <span class="keyword">true</span>);</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>}</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>export <span class="keyword">function</span> adjustGreen(amount)</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>{</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>  <span class="keywordflow">return</span> setGreen(shortToPercent(wrapShort(color()._g, amount)), <span class="keyword">true</span>);</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>}</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span> </div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>export <span class="keyword">function</span> adjustBlue(amount)</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>{</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>  <span class="keywordflow">return</span> setBlue(shortToPercent(wrapShort(color()._b, amount)), <span class="keyword">true</span>);</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>}</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span> </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>export <span class="keyword">function</span> adjustAlpha(amount)</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>{</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>  <span class="keywordflow">return</span> setAlpha(wrapPercent(color().alpha(), shortToPercent(amount)) * 100, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>}</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span> </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span><span class="comment">// The hue channel steps are integer values in the range of (-360 - +360).</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>export <span class="keyword">function</span> adjustHue(amount)</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>{</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>  <span class="keywordflow">return</span> setHue(degreesToPercent(wrapDegrees(color().toHsv().h, amount)), <span class="keyword">true</span>);</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>}</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span> </div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span><span class="comment">// The S/V/L channel steps are percentage values in the range of (-100 - +100).</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span> </div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>export <span class="keyword">function</span> adjustSaturation(amount)</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>{</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>  <span class="keywordflow">return</span> setSaturation(wrapPercent(color().toHsv().s,  amount), <span class="keyword">true</span>);</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>}</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>export <span class="keyword">function</span> adjustValue(amount)</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>{</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>  <span class="keywordflow">return</span> setValue(wrapPercent(color().toHsv().v,  amount), <span class="keyword">true</span>);</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>}</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span> </div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span><span class="comment">// Note that this changes the color space of the current color to HSL.</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>export <span class="keyword">function</span> adjustLightness(amount)</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>{</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>  <span class="keywordflow">return</span> setLightness(wrapPercent(color().toHsl().l,  amount));</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>}</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span> </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span> </div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="comment">// ------------------------------------------</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="comment">// Text color functions</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span> </div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span><span class="comment">// Returns the current text Color object.</span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>export <span class="keyword">function</span> textColor()</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>{</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>  <span class="keywordflow">return</span> _data.textColor;</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>}</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span> </div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span><span class="comment">// Sets the current text color and updates the &quot;Text Color&quot; State with the color as an &quot;#RRGGBB&quot; format string.</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span><span class="comment">// See `setColor()` for allowed format specifics.</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>export <span class="keyword">function</span> setTextColor(color)</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>{</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>  _data.textColor = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>(color);</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>  _data.textColorAuto = (<a class="code hl_class" href="class_color.html">Color</a>.equals(COLOR_WHITE, _data.textColor) || <a class="code hl_class" href="class_color.html">Color</a>.equals(COLOR_BLACK, _data.textColor));</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>  <span class="comment">// Save the last used color and auto setting to persistent storage object (this is saved/restored with the Script Instance when plugin exits/starts)</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>  _data.instance.dataStore.textColor = _data.textColor.rgba();</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>  _data.instance.dataStore.textColorAuto = _data.textColorAuto;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>  sendTextColor();</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>}</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span> </div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span><span class="comment">// Set the hue component of the current text color to a percentage value (0 - 100) and returns the new color as an #AARRGGBB string.</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span><span class="comment">// If `percent` is zero, the text color is placed into &quot;auto&quot; mode which will show either light or dark text based on current main</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span><span class="comment">// color value (dark text on light color and vice versa).</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>export <span class="keyword">function</span> setTextHue(percent)</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>{</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>  _data.textColorAuto = !percent;</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>  <span class="keywordflow">if</span> (_data.textColorAuto) {</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    updateTextColor();</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>  }</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>  <span class="comment">// need to reset pure white or black colors to some primary color before shifting hue.</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>  <span class="keywordflow">if</span> (<a class="code hl_class" href="class_color.html">Color</a>.equals(COLOR_WHITE, textColor()) || <a class="code hl_class" href="class_color.html">Color</a>.equals(COLOR_BLACK, textColor()))</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    _data.textColor = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>({ r: 255, g: 0, b: 0 });</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>  var hsl = textColor().toHsl();</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>  hsl.h = percentToDegrees(percent);</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>  setTextColor(hsl);</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>}</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span> </div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span><span class="comment">// Internal helper to automatically set the text color based on current main color.</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span><span class="comment">// Only used when in &quot;auto text color&quot; mode.</span></div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span><span class="keyword">function</span> updateTextColor()</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>{</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>  <span class="keywordflow">if</span> (!_data.textColorAuto)</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>  <span class="keywordflow">if</span> (color().isLight()) {</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    <span class="keywordflow">if</span> (!<a class="code hl_class" href="class_color.html">Color</a>.equals(COLOR_BLACK, textColor()))</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>      setTextColor(COLOR_BLACK.clone());</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>  }</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>  <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    <span class="keywordflow">if</span> (!<a class="code hl_class" href="class_color.html">Color</a>.equals(COLOR_WHITE, textColor()))</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>      setTextColor(COLOR_WHITE.clone());</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>  }</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>}</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span><span class="comment">// Send a State update with the new text color value.</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span><span class="keyword">function</span> sendTextColor() {</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#gabc30c9dbb5074f0b2e36307a25f16ef3">stateUpdateById</a>(_data.textColorState, textColor().hex());</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>}</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span> </div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span><span class="comment">// ------------------------------------------</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span><span class="comment">// Color complement/series array generators.</span></div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span><span class="comment">// Generates a color complementary to the current color.</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="comment">// Updates/creates 1 State based on current instance name + &quot;_complement&quot;.</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>export <span class="keyword">function</span> <a class="code hl_function" href="class_color.html#a87d6ad92217614866d946757fba2d8f3">complement</a>()</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>{</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>  sendColorsArray([color().<a class="code hl_function" href="class_color.html#a87d6ad92217614866d946757fba2d8f3">complement</a>()], <span class="stringliteral">&quot;complement&quot;</span>);</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>}</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span> </div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span><span class="comment">// Generates 2 colors which are split-complementary to the current color.</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span><span class="comment">// Updates/creates 2 States based on current instance name + &quot;_splitcomp_1&quot; and  + &quot;_splitcomp_2&quot;.</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>export <span class="keyword">function</span> splitcomplement()</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>{</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>  sendColorsArray(color().splitcomplement().slice(1), <span class="stringliteral">&quot;splitcomp&quot;</span>);</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>}</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span> </div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span><span class="comment">// Generates up to `n` number of colors harmonious with the current color. Updates/creates States based on current instance name and numeric suffix.</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>export <span class="keyword">function</span> <a class="code hl_function" href="class_color.html#adfb086b470804a4f7dc911d2dd148cab">polyad</a>(n)</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>{</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>  _data.lastSeries = {t: <span class="stringliteral">&quot;polyad&quot;</span>, n: n, s: 0 };</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>  sendSeries();</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>  sendCurrentSeriesNameState();</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>}</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span> </div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span><span class="comment">// Generates up to `n` number of colors analogous to the current color. Updates/creates States based on current instance name and numeric suffix.</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>export <span class="keyword">function</span> analogous(n, slices = 30)</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>{</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>  _data.lastSeries = {t: <span class="stringliteral">&quot;analogous&quot;</span>, n: n, s: slices };</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>  sendSeries();</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>  sendCurrentSeriesNameState();</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>}</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span> </div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span><span class="comment">// Generates up to `n` number of monochromatic colors based on the current color. Updates/creates States based on current instance name and numeric suffix.</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>export <span class="keyword">function</span> monochromatic(n)</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>{</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>  _data.lastSeries = {t: <span class="stringliteral">&quot;monochromatic&quot;</span>, n: n, s: 0 };</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>  sendSeries();</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>  sendCurrentSeriesNameState();</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>}</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span><span class="comment">// This function clears the current color series (polyad, analogous, mono),</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span><span class="comment">// sending an array of `n` transparent colors instead. If `n` is -1 (default) then the count from the last</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span><span class="comment">// requested series is used.  If `n` is 0, then no transparent colors are sent (the last series color state values stay intact).</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span><span class="comment">// Can be used to simply clear any current series colors or to keep automatic updates of complement/split comp but w/out series updates.</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>export <span class="keyword">function</span> clearCurrentSeries(n = -1)</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>{</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>  _data.lastSeries.t = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>  <span class="keywordflow">if</span> (n) {</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    <span class="keywordflow">if</span> (n &lt; 0)</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>      n = _data.seriesMaxColors;</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    _data.lastSeries.n = n;</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    sendSeries();</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>  }</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>  sendCurrentSeriesNameState();</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>}</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span> </div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span><span class="comment">// Enables or disables the automatic updating of complement, split complement, and last selected series based on the current color.</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>export <span class="keyword">function</span> autoUpdateSeries(enable = <span class="keyword">true</span>)</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>{</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>  <span class="keywordflow">if</span> (_data.autoUpdateSeries === enable)</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>  _data.autoUpdateSeries = enable;</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>  updateSeries();</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>  sendAutoUpdateSeriesState();</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>  _data.instance.dataStore.autoUpdateSeries = _data.autoUpdateSeries;</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>}</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span><span class="comment">// Toggles the automatic series updates. Convenience for `autoUpdateSeries()` based on current setting.</span></div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>export <span class="keyword">function</span> autoUpdateSeriesToggle()</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>{</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>  autoUpdateSeries(!_data.autoUpdateSeries);</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>}</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span> </div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span><span class="comment">// Functions for setting and updating what happens when user presses a series color swatch.</span></div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span><span class="comment">// This could select the swatch color as the current color, or copy the swatch color to clipboard.</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span><span class="comment">// Toggles between the two available modes.  This is called in an Action triggered by a switch in the page.</span></div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>export <span class="keyword">function</span> toggleSeriesColorPressMode()</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>{</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>  <span class="keywordflow">if</span> (_data.seriesColorPressMode == <span class="stringliteral">&quot;select&quot;</span>)</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    _data.seriesColorPressMode = <span class="stringliteral">&quot;copy&quot;</span>;</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    _data.seriesColorPressMode = <span class="stringliteral">&quot;select&quot;</span>;</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>  <span class="comment">// Save current selection to persistent storage.</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>  _data.instance.dataStore.seriesColorPressMode = _data.seriesColorPressMode;</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>  <span class="comment">// Update the corresponding State for page UI updates.</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>  sendSeriesColorPressModeState();</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>}</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span> </div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span><span class="comment">// Internal color series helper functions</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span> </div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span><span class="comment">// This internal function generates the last requested color series.</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span><span class="keyword">function</span> sendSeries()</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>{</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>  <span class="comment">// Save the last used series to persistent storage object (this is saved/restored with the Script Instance when plugin exits/starts)</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>  _data.instance.dataStore.lastSeries = _data.lastSeries;</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>  <span class="keywordflow">switch</span>(_data.lastSeries.t) {</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>    <span class="keywordflow">case</span> <span class="stringliteral">&#39;polyad&#39;</span>:</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>      sendColorsArray(color().<a class="code hl_function" href="class_color.html#adfb086b470804a4f7dc911d2dd148cab">polyad</a>(_data.lastSeries.n+1).slice(1));</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>    <span class="keywordflow">case</span> <span class="stringliteral">&#39;analogous&#39;</span>:</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>      sendColorsArray(color().analogous(_data.lastSeries.n+1, _data.lastSeries.s).slice(1));</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    <span class="keywordflow">case</span> <span class="stringliteral">&#39;monochromatic&#39;</span>:</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>      sendColorsArray(color().monochromatic(_data.lastSeries.n+1).slice(1));</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    <span class="keywordflow">case</span> <span class="stringliteral">&#39;&#39;</span>: {</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>      let colors = [];</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>      [...Array(_data.lastSeries.n).keys()].forEach(() =&gt; colors.push(COLOR_TRANS));</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>      sendColorsArray(colors);</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    }</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span> </div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>  }</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>}</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span> </div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span><span class="comment">// This internal function is used by the array generator functions above to send results back to Touch Portal as States.</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span><span class="comment">// The states are created dynamically as needed (in case they do not exist yet), and then updated to the current value from the array.</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span><span class="comment">// The state IDs and names are based on the current Dynamic Script Engine instance which is running this module.</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span><span class="keyword">function</span> sendColorsArray(arry, stateNamePrefix = <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>{</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>  <span class="comment">// Comp. and split comp. arrays always have 1 or 2 members, respectively. When this function is called for either of those,</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>  <span class="comment">// the stateNamePrefix parameter is non-empty.</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>  <span class="comment">// The other color series can display up to _data.seriesMaxColors colors, which corresponds to the number</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>  <span class="comment">// of display &quot;slots&quot; on the color panel page design (6). If a color array has fewer than seriesMaxColors members</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>  <span class="comment">// then the rest get filled with transparent colors.</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>  <span class="keyword">const</span> maxIdx = arry.length - 1;</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>  <span class="keyword">const</span> maxColors = stateNamePrefix ? maxIdx + 1 : _data.seriesMaxColors;</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>  <span class="keywordflow">for</span> (let i=0; i &lt; maxColors; ++i) {</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    <span class="comment">// create the state ID</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    let stateId = _data.stateId + <span class="charliteral">&#39;_&#39;</span>;</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    <span class="keywordflow">if</span> (stateNamePrefix)</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>      stateId += stateNamePrefix;</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>      stateId += <span class="stringliteral">&quot;series&quot;</span>;</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    <span class="keywordflow">if</span> (maxColors &gt; 1)</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>      stateId += `_${i+1}`;</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    <span class="comment">// Create new state if needed</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    <span class="keywordflow">if</span> (_data.colorSeriesStates.indexOf(stateId) &lt; 0) {</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>      let stateDescript = STATES_GROUP_NAME + <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>      <span class="keywordflow">if</span> (stateNamePrefix)</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>        stateDescript += stateNamePrefix;</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>        stateDescript += <span class="stringliteral">&quot;series color&quot;</span>;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>      <span class="keywordflow">if</span> (maxColors &gt; 1)</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>        stateDescript += ` ${i+1}`;</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>      <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#ga63d93ca8505b73aa4a1903375d9b484f">stateCreate</a>(stateId, STATES_GROUP_NAME, stateDescript, <span class="stringliteral">&quot;#00000000&quot;</span>);</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>      _data.colorSeriesStates.push(stateId);</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    }</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <span class="comment">// Now send the actual color. But first, if the given array does not have a color for this array index,</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    <span class="comment">//  then fill it with a transparent color instead.</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    <span class="keywordflow">if</span> (i &gt; maxIdx)</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>      arry.push(COLOR_TRANS);</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>    <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#gabc30c9dbb5074f0b2e36307a25f16ef3">stateUpdateById</a>(stateId, arry[i].<a class="code hl_function" href="class_color.html#af7a57ec62f370d92e749c92e43e62f68">tpcolor</a>().toUpperCase());</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>  }</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>}</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span> </div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span><span class="comment">// Internal function used to perform automatic updates of complement/split comp./series colors when current color changes.</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span><span class="keyword">function</span> updateSeries()</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>{</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>  <span class="keywordflow">if</span> (!_data.autoUpdateSeries)</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>  <a class="code hl_function" href="class_color.html#a87d6ad92217614866d946757fba2d8f3">complement</a>();</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>  splitcomplement();</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>  sendSeries();</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>}</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span> </div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span><span class="comment">// Internal function to send the name of the currently selected color series as a State,</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span><span class="comment">// eg. for highlighting the corresponding button on the page.</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span><span class="keyword">function</span> sendCurrentSeriesNameState()</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>{</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>  var seriesName = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>  <span class="comment">// Format the series name to look like the function call which invoked it (this way the parameters can also be matched);</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>  <span class="comment">// eg: &quot;analogous(6, 18)&quot;</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>  <span class="keywordflow">if</span> (_data.lastSeries.t) {</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>    seriesName = `${_data.lastSeries.t}(${_data.lastSeries.n}`;</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    <span class="keywordflow">if</span> (_data.lastSeries.s &gt; 0)</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>      seriesName += <span class="stringliteral">&quot;, &quot;</span> + _data.lastSeries.s;</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    seriesName += <span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>  }</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#gabc30c9dbb5074f0b2e36307a25f16ef3">stateUpdateById</a>(_data.lastSeriesNameState, seriesName);</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>}</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span> </div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span><span class="comment">// Send a State update with the new value of the autoUpdateSeries setting (eg. to use as button visual change trigger).</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span><span class="keyword">function</span> sendAutoUpdateSeriesState()</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>{</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#gabc30c9dbb5074f0b2e36307a25f16ef3">stateUpdateById</a>(_data.autoUpdateEnabledState, _data.autoUpdateSeries ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>}</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span> </div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span><span class="comment">// Send a State update with the current value of the seriesColorPressMode setting.</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span><span class="keyword">function</span> sendSeriesColorPressModeState()</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>{</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#gabc30c9dbb5074f0b2e36307a25f16ef3">stateUpdateById</a>(_data.seriesColorPressModeState, _data.seriesColorPressMode);</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>}</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span> </div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span> </div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span><span class="comment">// ------------------------------------------</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span><span class="comment">// Clipboard functions. Uses Clipboard example module, imported at top.</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span><span class="comment">// NOTE: Linux requires `xclip` utility installed.</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span> </div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span><span class="comment">// Tries to set a new color from a clipboard value. Accepted formats are same as described in `setColor()` above.</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span><span class="comment">// In case the clipboard does not hold a valid color value, this function will log a warning message and return</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span><span class="comment">// the current color instead (no changes to current color will be made).</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>export <span class="keyword">function</span> fromClipboard()</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>{</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>  <span class="keyword">const</span> val = clipboardToValue();</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>  <span class="comment">// console.log(&quot;Clipboard value:&quot;, val);</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>  <span class="keyword">const</span> color = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>(val);</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>  <span class="keywordflow">if</span> (color.isValid())</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    <span class="keywordflow">return</span> setColor(color);</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>  console.error(<span class="stringliteral">&quot;Clipboard contents were not a valid color.&quot;</span>);</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="class_color.html#af7a57ec62f370d92e749c92e43e62f68">tpcolor</a>();</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>}</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span> </div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span> </div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span><span class="comment">// --------------------------------------</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="comment">// Miscellaneous exported/public &quot;utility&quot; functions.</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span> </div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span><span class="comment">// Converts a &quot;#AARRGGBB&quot; color format string to &quot;#RRGGBBAA&quot; format.  If input is less than 9 characters long then</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span><span class="comment">// no conversion is done and the original string is returned.</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>export <span class="keyword">function</span> argb2rgba(argbString)</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>{</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>  <span class="keywordflow">return</span> argbString.length === 9 ? argbString.replace(/^#([0-9a-z]{2})([0-9a-z]{6})$/i, <span class="stringliteral">&#39;#$2$1&#39;</span>) : argbString;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>}</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span> </div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span><span class="comment">// Returns a new Color instance from &quot;#AARRGGBB&quot; or &quot;#RRGGBB&quot; string input.</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>export <span class="keyword">function</span> colorFromArgb(argbString)</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>{</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>(argb2rgba(argbString));</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>}</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span> </div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span><span class="comment">// Returns a color formatted as &quot;#RRGGBB&quot; or &quot;#RRGGBBAA&quot; depending on the current alpha channel value.</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span><span class="comment">// The alpha component will be included if it is not fully opaque (&lt; 1.0).</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>export <span class="keyword">function</span> hexColor(color)</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>{</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>  <span class="keyword">const</span> c = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>(color);</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>  <span class="keywordflow">if</span> (c.alpha() &lt; 1)</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>    <span class="keywordflow">return</span> c.rgba();</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>  <span class="keywordflow">return</span> c.hex();</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>}</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span> </div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span><span class="comment">// Takes a &quot;#AARRGGBB&quot; or &quot;#RRGGBB&quot; string input and</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span><span class="comment">// returns a color formatted as &quot;#RRGGBB&quot; or &quot;#RRGGBBAA&quot; depending on the current alpha channel value.</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>export <span class="keyword">function</span> hexFromArgb(argbString)</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>{</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>  <span class="keywordflow">return</span> hexColor(colorFromArgb(argbString));</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>}</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span> </div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span> </div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span><span class="comment">// ---------  No further exported/public functions below -----------------</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span> </div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span><span class="comment">// ------------------------------------------</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span><span class="comment">// Connector/slider feedback handling</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span><span class="comment">// These functions are all about updating the slider positions in the page to correspond to the currently selected color.</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span><span class="comment">// For example if the Hue is adjusted, the RGB sliders should be updated to reflect the current values, and vice versa.</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span><span class="comment">// Or if the step buttons are used to adjust color instead of the sliders, the sliders should still reflect the current position (as closely as possible).</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span> </div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span><span class="comment">// This function queries the global DSE connector tracking database to try to find the &quot;short ID&quot; of the connector</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span><span class="comment">// we&#39;re interested in.  We can do this based on some criteria; in this case we can use the current instance (State) Name,</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="comment">// (which was read and saved in `init()``) and also the expression being used. For example the red channel</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span><span class="comment">// slider uses the expression &quot;M.setRed(${connector_value})&quot;. So if we search for &quot;*setRed*&quot; (using wildcards), this should give us the</span></div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span><span class="comment">// slider for the red channel.</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span><span class="comment">// We also cache (save) the short ID lookups, because they are not going to change very often, if ever, and searching for</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span><span class="comment">// them every time a slider is moved is a waste. See the `init()` function at the bottom for how the cache is cleared if connectors are changed on the page.</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span><span class="keyword">function</span> getShortId(channel)</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>{</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>  <span class="keywordflow">if</span> (!_data.connectorIds[channel]) {</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>    <span class="keyword">const</span> shortIds = <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#ga0a3a527fe1dfb180f5cc7636ada537b9">getConnectorShortIds</a>({ instanceName: _data.instanceName, expression: `*<span class="keyword">set</span>${channel}*` });</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    <span class="keywordflow">if</span> (shortIds.length)</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>      _data.connectorIds[channel] = shortIds[0];</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>    <span class="comment">//console.log(channel, _data.connectorIds[channel]);</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>  }</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>  <span class="keywordflow">return</span> _data.connectorIds[channel];</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>}</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span> </div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span><span class="comment">// Generic function to update any of the color channel sliders by name with given value.</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span><span class="keyword">function</span> updateConnector(channel, value)</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>{</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>  <span class="keyword">const</span> shortId = getShortId(channel);</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>  <span class="keywordflow">if</span> (shortId)</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    <a class="code hl_class" href="class_t_p.html">TP</a>.connectorUpdateShort(shortId, value.clamp(0, 100));</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>}</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span> </div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span><span class="comment">// These functions are basically just conveniences to set each slider individually, instead of repeating the same code in several of places.</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span><span class="keyword">function</span> updateRedConnector(r)     { updateConnector(<span class="stringliteral">&quot;Red&quot;</span>, <a class="code hl_function" href="class_number.html#a2976963ff8c410133040d33ae41a46d6">round</a>(shortToPercent(r))); }</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span><span class="keyword">function</span> updateGreenConnector(g)   { updateConnector(<span class="stringliteral">&quot;Green&quot;</span>, <a class="code hl_function" href="class_number.html#a2976963ff8c410133040d33ae41a46d6">round</a>(shortToPercent(g))); }</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span><span class="keyword">function</span> updateBlueConnector(b)    { updateConnector(<span class="stringliteral">&quot;Blue&quot;</span>, <a class="code hl_function" href="class_number.html#a2976963ff8c410133040d33ae41a46d6">round</a>(shortToPercent(b))); }</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span><span class="keyword">function</span> updateAlphaConnector(a)   { updateConnector(<span class="stringliteral">&quot;Alpha&quot;</span>, <a class="code hl_function" href="class_number.html#a2976963ff8c410133040d33ae41a46d6">round</a>(a * 100)); }</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span><span class="keyword">function</span> updateHueConnector(h)     { updateConnector(<span class="stringliteral">&quot;Hue&quot;</span>, <a class="code hl_function" href="class_number.html#a2976963ff8c410133040d33ae41a46d6">round</a>(degreesToPercent(h))); }</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span><span class="keyword">function</span> updateSatConnector(s)     { updateConnector(<span class="stringliteral">&quot;Saturation&quot;</span>, <a class="code hl_function" href="class_number.html#a2976963ff8c410133040d33ae41a46d6">round</a>(s * 100)); }</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span><span class="keyword">function</span> updateValueConnector(v)   { updateConnector(<span class="stringliteral">&quot;Value&quot;</span>, <a class="code hl_function" href="class_number.html#a2976963ff8c410133040d33ae41a46d6">round</a>(v * 100)); }</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span><span class="keyword">function</span> updateTextHueConnector(h) { updateConnector(<span class="stringliteral">&quot;TextHue&quot;</span>, <a class="code hl_function" href="class_number.html#a2976963ff8c410133040d33ae41a46d6">round</a>(degreesToPercent(h))); }</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span> </div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span><span class="comment">// This function sets all the RGB sliders, eg. when any of the HSV controls change.</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span><span class="keyword">function</span> updateRgbConnectors()</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>{</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>  <span class="keyword">const</span> rgb = color().toRgb();</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>  updateRedConnector(rgb.r);</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>  updateGreenConnector(rgb.g);</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>  updateBlueConnector(rgb.b);</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>}</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span><span class="comment">// This function sets all the HSV slider, eg. when any of the RGB channels change.</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span><span class="keyword">function</span> updateHsvConnectors()</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>{</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>  <span class="keyword">const</span> hsv = color().toHsv();</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>  updateHueConnector(hsv.h);</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>  updateSatConnector(hsv.s);</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>  updateValueConnector(hsv.v);</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>}</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span> </div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span><span class="comment">// ------------------------------------------</span></div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span><span class="comment">// Other internal utility functions/data.</span></div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span> </div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span><span class="comment">// This function runs each time the current color is updated. It runs any related updaters as needed</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span><span class="comment">// (eg. the automatic text color and series generators), potentially updates connectors, and most</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span><span class="comment">// importantly it sends the current color to TP, both as an `#AARRGGBB` value for displaying on the swatch,</span></div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span><span class="comment">// and as a formatted string (using the FORMATTED_COLOR_TEMPLATE template defined at the top)</span></div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span><span class="comment">// with the current color values for displaying on top of the swatch (or wherever).</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span><span class="comment">// connectors to update: 0 = none; 1 = rgb; 2 = hsv; 3 = rgb + hsv + alpha</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span><span class="keyword">function</span> update(connectors = 0)</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>{</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#gabc30c9dbb5074f0b2e36307a25f16ef3">stateUpdateById</a>(_data.stateId, <a class="code hl_function" href="class_color.html#af7a57ec62f370d92e749c92e43e62f68">tpcolor</a>());</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>  updateTextColor();</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>  updateSeries();</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span> </div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>  <span class="comment">// Update the saved color value in persistent data. Next time the color panel instance is loaded from settings, the last used color will be restored.</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>  _data.instance.dataStore.color = _data.color.rgba();</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span> </div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>  <span class="comment">// Send a State update with the new color as formatted text.</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>  <span class="keyword">const</span> rgb = _data.color.toRgb();</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>  <span class="keyword">const</span> hsv = _data.color.toHsv();</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>  <span class="keyword">const</span> lum = _data.color.luminance();</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>  <span class="comment">//const hsl = _data.color.toHsl();</span></div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>  <span class="keyword">const</span> value = <a class="code hl_function" href="class_global.html#a27f7e21ddf66fa9aaaf37ec4734f504c">Format</a>(</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>    FORMATTED_COLOR_TEMPLATE,</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>    shortToPercent(rgb.r) * .01, shortToPercent(rgb.g) * .01, shortToPercent(rgb.b) * .01, rgb.a, degreesToPercent(hsv.h) * .01, hsv.s, hsv.v, lum,</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>    rgb.r, rgb.g, rgb.b, percentToShort(rgb.a * 100), hsv.h, percentToShort(hsv.s * 100), percentToShort(hsv.v * 100), percentToShort(lum * 100)</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>  );</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#gabc30c9dbb5074f0b2e36307a25f16ef3">stateUpdateById</a>(_data.formattedColorState, value);</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>  <span class="comment">//console.log(lum, hsl.l, hsv.h, hsl.h, hsv.s, hsl.s);</span></div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span> </div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>  <span class="comment">// loop over all the color channel values and update States as needed.</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> [k, v] of Object.entries(_data.channelValues)) {</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>    <span class="keywordflow">if</span> (!v.state)</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>    <span class="keyword">const</span> newVal = v.get(rgb, hsv, lum);</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>    <span class="keywordflow">if</span> (newVal != v.v) {</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>      v.v = newVal;</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>      <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#gabc30c9dbb5074f0b2e36307a25f16ef3">stateUpdateById</a>(v.state, <a class="code hl_function" href="class_global.html#a27f7e21ddf66fa9aaaf37ec4734f504c">Format</a>(v.fmt, v.v));</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>    }</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>  }</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span> </div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>  <span class="keywordflow">if</span> (connectors &amp; 1)</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    updateRgbConnectors();</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>  <span class="keywordflow">if</span> (connectors &amp; 2)</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>    updateHsvConnectors();</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>  <span class="keywordflow">if</span> (connectors == 3)</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>    updateAlphaConnector(rgb.a);</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span> </div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>  <span class="comment">//return tpcolor();</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>  <span class="keywordflow">return</span> undefined;</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>}</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span> </div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span><span class="keyword">function</span> updateRepeatRate(ms) {</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#gabc30c9dbb5074f0b2e36307a25f16ef3">stateUpdateById</a>(_data.repeatRateState, ms.toString());</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>}</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span><span class="keyword">function</span> updateRepeatDelay(ms) {</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#gabc30c9dbb5074f0b2e36307a25f16ef3">stateUpdateById</a>(_data.repeatDelayState, ms.toString());</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>}</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span> </div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span><span class="comment">// Do first-run initialization tasks.</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span><span class="keyword">function</span> init()</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>{</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>  <span class="keywordflow">if</span> (_data.init)</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>  console.info(<span class="stringliteral">&quot;DSE Color Panel: initializing...&quot;</span>);</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span> </div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>  <span class="comment">// Get the current script instance object (`DynamicScript` type);</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>  _data.instance = <a class="code hl_class" href="class_d_s_e.html">DSE</a>.<a class="code hl_function" href="class_d_s_e.html#a4dc79d45688d568fdb138dac9b0c6c01">currentInstance</a>();</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>  <span class="keywordflow">if</span> (!_data.instance) {</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    console.error(<span class="stringliteral">&quot;Something went wrong, could not find current DynamicScript instance!&quot;</span>);</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>  }</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>  _data.stateId = _data.instance.stateId;</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>  _data.instanceName = _data.instance.name;</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>  <span class="comment">// Set the category and name with which the primary State will be created.</span></div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>  _data.instance.stateParentCategory = STATES_GROUP_NAME;</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>  _data.instance.stateName = STATE_CURRENT_COLOR_NAME;</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span> </div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>  <span class="comment">// Get the stored persistent data object</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>  <span class="keyword">const</span> ds = _data.instance.dataStore;</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>  <span class="comment">// Restore persistently stored data, if any, otherwise create it.</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>  <span class="keywordflow">if</span> (ds.color) {</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>    console.info(<span class="stringliteral">&quot;DSE Color Panel: restoring saved state&quot;</span>);</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>    _data.color = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>(ds.color);</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>    _data.textColor = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>(ds.textColor);</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>    _data.textColorAuto = ds.textColorAuto;</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>    _data.lastSeries = ds.lastSeries;</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>    _data.autoUpdateSeries = ds.autoUpdateSeries;</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>    <span class="keywordflow">if</span> (ds.seriesColorPressMode)</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>      _data.seriesColorPressMode = ds.seriesColorPressMode;</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>  }</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>  <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>    console.info(<span class="stringliteral">&quot;DSE Color Panel: no saved state found, creating new data store&quot;</span>);</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>    ds.color = _data.color.rgba();</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>    ds.textColor = _data.textColor.rgba();</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>    ds.textColorAuto = _data.textColorAuto;</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>    ds.lastSeries = _data.lastSeries;</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>    ds.autoUpdateSeries = _data.autoUpdateSeries;</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>    ds.seriesColorPressMode = _data.seriesColorPressMode;</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>  }</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span> </div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>  <span class="comment">// Create a State for primary color as formatted text.</span></div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>  _data.formattedColorState = _data.stateId + <span class="stringliteral">&#39;_formatted&#39;</span>;</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>  let stateDescript = STATES_GROUP_NAME + <span class="stringliteral">&quot; Formatted Color&quot;</span>;</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>  <span class="comment">//              ID,                       Category,          Description,   Default</span></div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#ga63d93ca8505b73aa4a1903375d9b484f">stateCreate</a>(_data.formattedColorState, STATES_GROUP_NAME, stateDescript, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span> </div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>  <span class="comment">// Loop over all the color channel values and create States.</span></div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> [k, v] of Object.entries(_data.channelValues)) {</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>    <span class="comment">// Create a state with a friendly name for this channel.</span></div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>    v.state = _data.stateId + <span class="stringliteral">&#39;_channel_&#39;</span> + k;</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>    stateDescript = STATES_GROUP_NAME + <span class="stringliteral">&quot; Channel Value: &quot;</span> + v.name;</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>    <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#ga63d93ca8505b73aa4a1903375d9b484f">stateCreate</a>(v.state, STATES_GROUP_NAME, stateDescript, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>  }</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span> </div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>  <span class="comment">// Create a State for the current text color value.</span></div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>  _data.textColorState = _data.stateId + <span class="stringliteral">&#39;_textColor&#39;</span>;</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>  stateDescript = STATES_GROUP_NAME + <span class="stringliteral">&quot; Text Color&quot;</span>;</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>  <span class="comment">// the default should be the actual text color, but due to a &quot;bug&quot; in TP &lt;= v3.1 we need to force it to a &quot;wrong&quot; value first.</span></div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#ga63d93ca8505b73aa4a1903375d9b484f">stateCreate</a>(_data.textColorState, STATES_GROUP_NAME, stateDescript, _data.textColor.lighten().rgba());</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span> </div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>  <span class="comment">// Create a State for the current series color swatch press mode</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>  _data.seriesColorPressModeState = _data.stateId + <span class="stringliteral">&#39;_seriesColorPressMode&#39;</span>;</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>  stateDescript = STATES_GROUP_NAME + <span class="stringliteral">&quot; Series Color Swatch Press Mode&quot;</span>;</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#ga63d93ca8505b73aa4a1903375d9b484f">stateCreate</a>(_data.seriesColorPressModeState, STATES_GROUP_NAME, stateDescript, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span> </div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>  <span class="comment">// Create the State current color series name.</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>  _data.lastSeriesNameState = _data.stateId + <span class="stringliteral">&#39;_selectedSeries&#39;</span>;</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>  stateDescript = STATES_GROUP_NAME + <span class="stringliteral">&quot; Selected Color Series&quot;</span>;</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>  <span class="comment">// the default should be 0, but due to a &quot;bug&quot; in TP &lt;= v3.1 we need to force it to a blank value first.</span></div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#ga63d93ca8505b73aa4a1903375d9b484f">stateCreate</a>(_data.lastSeriesNameState, STATES_GROUP_NAME, stateDescript, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span> </div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>  <span class="comment">// Create a State for the autoUpdateSeries flag.</span></div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>  _data.autoUpdateEnabledState = _data.stateId + <span class="stringliteral">&#39;_autoUpdateSeries&#39;</span>;</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>  stateDescript = STATES_GROUP_NAME + <span class="stringliteral">&quot; Auto Update Complement/Series&quot;</span>;</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>  <span class="comment">// the default should be 0, but due to a &quot;bug&quot; in TP &lt;= v3.1 we need to force it to a blank value first.</span></div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#ga63d93ca8505b73aa4a1903375d9b484f">stateCreate</a>(_data.autoUpdateEnabledState, STATES_GROUP_NAME, stateDescript, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span> </div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>  <span class="comment">// Create States for the current action repeat rate and delay.</span></div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>  _data.repeatRateState = _data.stateId + <span class="stringliteral">&#39;_actionRepeatRate&#39;</span>;</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>  stateDescript = STATES_GROUP_NAME + <span class="stringliteral">&quot; Color Channel Button Repeat Rate&quot;</span>;</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#ga63d93ca8505b73aa4a1903375d9b484f">stateCreate</a>(_data.repeatRateState, STATES_GROUP_NAME, stateDescript, <span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>  _data.repeatDelayState = _data.stateId + <span class="stringliteral">&#39;_actionRepeatDelay&#39;</span>;</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>  stateDescript = STATES_GROUP_NAME + <span class="stringliteral">&quot; Color Channel Button Repeat Delay&quot;</span>;</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.<a class="code hl_function" href="group___t_p_a_p_i.html#ga63d93ca8505b73aa4a1903375d9b484f">stateCreate</a>(_data.repeatDelayState, STATES_GROUP_NAME, stateDescript, <span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span> </div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>  <span class="comment">// Connect to the `DynamicScript.repeat*Changed` events to send repeat rate/delay state updates.</span></div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>  _data.instance.repeatRateChanged.connect(updateRepeatRate);</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>  _data.instance.repeatDelayChanged.connect(updateRepeatDelay);</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span> </div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>  <span class="comment">// Register an event handler with the global connectors database to get notified</span></div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>  <span class="comment">// when connector data has been updated (eg. a slider has been added/removed/changed).</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>  <span class="comment">// For our needs it&#39;s simpler to just clear the cache when this happens, and it will</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>  <span class="comment">// be re-populated automatically as needed (in `getShortId()`);</span></div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>  <span class="comment">// The `connectorIdsChanged()` event has one parameter, which is the name of the instance/State</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>  <span class="comment">// for which the changed connector(s) are used (this is in their State Name field). So</span></div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>  <span class="comment">// we only need to react to changes made to &quot;our&quot; connectors, where the instanceName matches the</span></div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>  <span class="comment">// current one in `_data.instanceName`.</span></div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>  <a class="code hl_class" href="class_t_p.html">TP</a>.onconnectorIdsChanged( (instanceName) =&gt; {</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>    <span class="keywordflow">if</span> (instanceName == _data.instanceName) {</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>      _data.connectorIds = {};</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>      console.info(<span class="stringliteral">&quot;Connector ID cache cleared.&quot;</span>);</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>    }</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>  });</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span> </div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>  <span class="comment">// Send state updates now to trigger any TP events and update displays.</span></div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>  update(3);</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>  sendCurrentSeriesNameState();</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>  sendAutoUpdateSeriesState();</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>  sendSeriesColorPressModeState();</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>  updateRepeatRate(_data.instance.effectiveRepeatRate);</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>  updateRepeatDelay(_data.instance.effectiveRepeatDelay);</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span> </div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>  _data.init = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>  console.info(<span class="stringliteral">&quot;DSE Color Panel: initialization completed.&quot;</span>);</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>}</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span> </div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span><span class="keyword">const</span> COLOR_BLACK = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>({ r: 0, g: 0, b: 0 });</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span><span class="keyword">const</span> COLOR_WHITE = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>({ r: 255, g: 255, b: 255 });</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span><span class="keyword">const</span> COLOR_TRANS = <span class="keyword">new</span> <a class="code hl_class" href="class_color.html">Color</a>({ r: 0, g: 0, b: 0, a: 0 });</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span> </div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span><span class="comment">// Internal temporary data storage. _data is undefined at startup and after an Engine reset.</span></div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>var _data = _data ||</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>{</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>  color: COLOR_WHITE.clone(),         <span class="comment">// the current color</span></div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>  textColor: COLOR_BLACK.clone(),     <span class="comment">// the current text color (eg. to show on color swatch)</span></div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>  init: <span class="keyword">false</span>,                        <span class="comment">// initialization flag, set to true after first time `init()` is called.</span></div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>  <a class="code hl_function" href="class_d_s_e.html#a75772c2c90dcccaa883c44867c7da11a">instance</a>: <span class="keyword">null</span>,                     <span class="comment">// the ColorPanel primary Script Instance, set in init()</span></div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>  instanceName: <span class="stringliteral">&quot;&quot;</span>,                   <span class="comment">// primary Script Instance Name, set in init()</span></div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>  stateId: <span class="stringliteral">&quot;&quot;</span>,                        <span class="comment">// State ID for the current color value; set in init()</span></div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>  textColorAuto: <span class="keyword">true</span>,                <span class="comment">// whether to automatically set the text color based on overall darkness of current main color</span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>  seriesColorPressMode: <span class="stringliteral">&#39;select&#39;</span>,     <span class="comment">// stores the desired behavior when user presses one of the color series tiles: &#39;select&#39; or &#39;copy&#39;</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>  autoUpdateSeries: <span class="keyword">false</span>,            <span class="comment">// enable/disable automatic update of complement/split comp./last series when current color changes</span></div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>  lastSeries: { t: <span class="stringliteral">&quot;&quot;</span>, n: 0, s: 0 },  <span class="comment">// track which series type was last selected (if any)</span></div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>  seriesMaxColors: 6,                 <span class="comment">// maximum number of colors in a series; should match the page layout</span></div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>  colorSeriesStates: [],              <span class="comment">// keep track of created state IDs for color series so we do not re-create them each time</span></div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>  formattedColorState: <span class="stringliteral">&quot;&quot;</span>,            <span class="comment">// ID of created formatted color state</span></div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>  textColorState: <span class="stringliteral">&quot;&quot;</span>,                 <span class="comment">// ID of created text color state</span></div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>  seriesColorPressModeState: <span class="stringliteral">&quot;&quot;</span>,      <span class="comment">// ID of created state for seriesColorPressMode value</span></div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>  lastSeriesNameState: <span class="stringliteral">&quot;&quot;</span>,            <span class="comment">// ID of created state for the last selected color series name</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>  autoUpdateEnabledState: <span class="stringliteral">&quot;&quot;</span>,         <span class="comment">// ID of created series auto-update status state</span></div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>  repeatRateState: <span class="stringliteral">&quot;&quot;</span>,                <span class="comment">// ID of created action repeat rate value state</span></div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>  repeatDelayState: <span class="stringliteral">&quot;&quot;</span>,               <span class="comment">// ID of created action repeat delay value state</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>  connectorIds: {},                   <span class="comment">// track connector `shortId`s which are used in the page to set color values; these are used for updating slider positions.</span></div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>  <span class="comment">// track values and states of color channels (to show under sliders, for example);</span></div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>  <span class="comment">// track the values so that we do not send needless updates when they do not actually change; also makes it possible to reference the current channel value at any time</span></div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>  channelValues: {</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>  <span class="comment">//C:   Name for State,     Value, State ID,  Get value function,                              Formatting string  (.NET style for `String.format()`)</span></div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>    r: { name: <span class="stringliteral">&quot;Red&quot;</span>,        v: -1, state: <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">get</span>: (rgb, _, __) =&gt; shortToPercent(rgb.r), fmt: <span class="stringliteral">&quot;{0:00.0} %&quot;</span> },</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>    g: { name: <span class="stringliteral">&quot;Green&quot;</span>,      v: -1, state: <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">get</span>: (rgb, _, __) =&gt; shortToPercent(rgb.g), fmt: <span class="stringliteral">&quot;{0:00.0} %&quot;</span> },</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>    b: { name: <span class="stringliteral">&quot;Blue&quot;</span>,       v: -1, state: <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">get</span>: (rgb, _, __) =&gt; shortToPercent(rgb.b), fmt: <span class="stringliteral">&quot;{0:00.0} %&quot;</span> },</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>    a: { name: <span class="stringliteral">&quot;Alpha&quot;</span>,      v: -1, state: <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">get</span>: (rgb, _, __) =&gt; rgb.a * 100,           fmt: <span class="stringliteral">&quot;{0:00} %&quot;</span> },</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>    h: { name: <span class="stringliteral">&quot;Hue&quot;</span>,        v: -1, state: <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">get</span>: (_, hsv, __) =&gt; hsv.h,                 fmt: <span class="stringliteral">&quot;{0:000} °&quot;</span>  },</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>    s: { name: <span class="stringliteral">&quot;Saturation&quot;</span>, v: -1, state: <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">get</span>: (_, hsv, __) =&gt; hsv.s * 100,           fmt: <span class="stringliteral">&quot;{0:00.0} %&quot;</span> },</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>    v: { name: <span class="stringliteral">&quot;Value&quot;</span>,      v: -1, state: <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">get</span>: (_, hsv, __) =&gt; hsv.v * 100,           fmt: <span class="stringliteral">&quot;{0:00.0} %&quot;</span> },</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>    l: { name: <span class="stringliteral">&quot;Lightness&quot;</span>,  v: -1, state: <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">get</span>: (_, __,   l) =&gt; l * 100,               fmt: <span class="stringliteral">&quot;{0:00.0} %&quot;</span> },</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span><span class="comment">    // For example to display the RGB values in 0-256 range instead of percent, change the result value and the format string:</span></div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span><span class="comment">    r: { name: &quot;Red&quot;,        v: -1, state: &quot;&quot;, get: (rgb, _, __) =&gt; rgb.r,                 fmt: &quot;{0:000}&quot;  },</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span><span class="comment">    g: { name: &quot;Green&quot;,      v: -1, state: &quot;&quot;, get: (rgb, _, __) =&gt; rgb.g,                 fmt: &quot;{0:000}&quot;  },</span></div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span><span class="comment">    b: { name: &quot;Blue&quot;,       v: -1, state: &quot;&quot;, get: (rgb, _, __) =&gt; rgb.b,                 fmt: &quot;{0:000}&quot;  },</span></div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span><span class="comment">    */</span></div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>  },</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>};</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span> </div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span><span class="comment">// Initialize on first load (or import, since this is a module).</span></div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span><span class="keywordflow">if</span> (!_data.init)</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>  init();</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span> </div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span><span class="comment">// Conversion utilities</span></div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span><span class="keyword">function</span> percentToShort(value) { <span class="keywordflow">return</span> <a class="code hl_function" href="class_number.html#a2976963ff8c410133040d33ae41a46d6">round</a>(value.clamp(0, 100) * 2.55); }</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span><span class="keyword">function</span> shortToPercent(value) { <span class="keywordflow">return</span> value.clamp(-255, 255) / 2.55 }</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span><span class="keyword">function</span> percentToDegrees(value) { <span class="keywordflow">return</span> <a class="code hl_function" href="class_number.html#a2976963ff8c410133040d33ae41a46d6">round</a>(value.clamp(0, 100) * 3.6); }</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span><span class="keyword">function</span> degreesToPercent(value) { <span class="keywordflow">return</span> value.clamp(-360, 360) / 3.6; }</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span> </div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span><span class="keyword">function</span> wrapShort(v, d)</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>{</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>  var p = (v + d.clamp(-255, 255)) % 256;</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>  <span class="keywordflow">return</span> (p &lt; 0 ? 256 + p : p);</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>}</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span> </div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span><span class="keyword">function</span> wrapDegrees(v, d)</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>{</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>  var p = (v + d.clamp(-360, 360)) % 360;</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>  <span class="keywordflow">return</span> (p &lt; 0 ? 360 + p : p);</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>}</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span> </div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span><span class="keyword">function</span> wrapPercent(v, d)</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>{</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>  var p = v + <a class="code hl_function" href="class_math.html#a53efc2dcfced77d30083e84a38572130">clamp</a>(d * 0.01, -1, 1);</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>  <span class="keywordflow">return</span> p - floor(p);</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>}</div>
<div class="ttc" id="aclass_color_html"><div class="ttname"><a href="class_color.html">Color</a></div><div class="ttdoc">Provides functions for working with color.</div></div>
<div class="ttc" id="aclass_color_html_a87d6ad92217614866d946757fba2d8f3"><div class="ttname"><a href="class_color.html#a87d6ad92217614866d946757fba2d8f3">Color::complement</a></div><div class="ttdeci">Color complement(Color color)</div><div class="ttdoc">Returns a new Color which is complimentary to color.</div></div>
<div class="ttc" id="aclass_color_html_adfb086b470804a4f7dc911d2dd148cab"><div class="ttname"><a href="class_color.html#adfb086b470804a4f7dc911d2dd148cab">Color::polyad</a></div><div class="ttdeci">Color polyad(number n)</div><div class="ttdoc">Returns an array of up to n colors harmonious with this color.</div></div>
<div class="ttc" id="aclass_color_html_af7a57ec62f370d92e749c92e43e62f68"><div class="ttname"><a href="class_color.html#af7a57ec62f370d92e749c92e43e62f68">Color::tpcolor</a></div><div class="ttdeci">string tpcolor()</div><div class="ttdoc">Returns color formatted in #AARRGGBB format (this is suitable for use with Touch Portal's &quot;Set Text/B...</div><div class="ttdef"><b>Definition:</b> color.js:474</div></div>
<div class="ttc" id="aclass_d_s_e_html"><div class="ttname"><a href="class_d_s_e.html">DSE</a></div><div class="ttdoc">The DSE object contains constants and functions related to the plugin environment....</div></div>
<div class="ttc" id="aclass_d_s_e_html_a4dc79d45688d568fdb138dac9b0c6c01"><div class="ttname"><a href="class_d_s_e.html#a4dc79d45688d568fdb138dac9b0c6c01">DSE::currentInstance</a></div><div class="ttdeci">DynamicScript currentInstance()</div><div class="ttdoc">Returns the current script Instance. This is equivalent to calling DSE.instance(DSE....</div><div class="ttdef"><b>Definition:</b> DSE.h:292</div></div>
<div class="ttc" id="aclass_d_s_e_html_a75772c2c90dcccaa883c44867c7da11a"><div class="ttname"><a href="class_d_s_e.html#a75772c2c90dcccaa883c44867c7da11a">DSE::instance</a></div><div class="ttdeci">DynamicScript instance(String name)</div><div class="ttdoc">Returns the script instance with given name, if any, otherwise returns null.</div></div>
<div class="ttc" id="aclass_global_html_a27f7e21ddf66fa9aaaf37ec4734f504c"><div class="ttname"><a href="class_global.html#a27f7e21ddf66fa9aaaf37ec4734f504c">Global::Format</a></div><div class="ttdeci">String Format(String format)</div><div class="ttdoc">Equivalent to the String.format() extension method.</div></div>
<div class="ttc" id="aclass_math_html_a53efc2dcfced77d30083e84a38572130"><div class="ttname"><a href="class_math.html#a53efc2dcfced77d30083e84a38572130">Math::clamp</a></div><div class="ttdeci">number clamp(number value, number min, number max)</div><div class="ttdoc">Constrain value between min and max values.</div></div>
<div class="ttc" id="aclass_number_html_a2976963ff8c410133040d33ae41a46d6"><div class="ttname"><a href="class_number.html#a2976963ff8c410133040d33ae41a46d6">Number::round</a></div><div class="ttdeci">number round(number precision)</div><div class="ttdoc">Round value to precision decimal places.</div></div>
<div class="ttc" id="aclass_t_p_html"><div class="ttname"><a href="class_t_p.html">TP</a></div><div class="ttdoc">The global TP namespace is used as a container for all Touch Portal API methods, which are invoked wi...</div><div class="ttdef"><b>Definition:</b> touchportal.dox:7</div></div>
<div class="ttc" id="agroup___t_p_a_p_i_html_ga0a3a527fe1dfb180f5cc7636ada537b9"><div class="ttname"><a href="group___t_p_a_p_i.html#ga0a3a527fe1dfb180f5cc7636ada537b9">TP::getConnectorShortIds</a></div><div class="ttdeci">Array&lt; String &gt; getConnectorShortIds(Object criteria={})</div><div class="ttdoc">Returns zero or more connector &quot;short IDs&quot; based on the given criteria from the currently logged conn...</div></div>
<div class="ttc" id="agroup___t_p_a_p_i_html_ga63d93ca8505b73aa4a1903375d9b484f"><div class="ttname"><a href="group___t_p_a_p_i.html#ga63d93ca8505b73aa4a1903375d9b484f">TP::stateCreate</a></div><div class="ttdeci">void stateCreate(String id, String parentGroup, String desc=&quot;&quot;, String defaultValue=&quot;&quot;)</div><div class="ttdoc">Create a new Touch Portal dynamic State (if it doesn't already exist).</div></div>
<div class="ttc" id="agroup___t_p_a_p_i_html_gabc30c9dbb5074f0b2e36307a25f16ef3"><div class="ttname"><a href="group___t_p_a_p_i.html#gabc30c9dbb5074f0b2e36307a25f16ef3">TP::stateUpdateById</a></div><div class="ttdeci">void stateUpdateById(String id, String value)</div><div class="ttdoc">Send a State update to Touch Portal for any arbitrary state/value matching the id,...</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="plugin_examples.html">Examples</a></li>
    <li class="footer">Generated for Dynamic Script Engine Plugin for Touch Portal &#160;v1.2.0.1-beta1 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
